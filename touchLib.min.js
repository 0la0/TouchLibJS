(function(k){var q={};function j(s){if(!s){return}if(s.elementId){try{this.parentEl=document.getElementById(s.elementId);if(this.parentEl==null){throw"cannot build object: param object needs an elementId";return}}catch(r){console.log("err getting element")}}else{throw"cannot build object: param object needs an elementId";return}this.canvasEl=document.createElement("canvas");this.parentEl.appendChild(this.canvasEl);if(s.cssClass){this.setClass(s.cssClass)}this.g2d=this.canvasEl.getContext("2d");this.setSize(s.width,s.height);this.g2d.clearRect(0,0,this.width,this.height);this.mouseIsDown=false;this.renderIsInQueue=false;this.registerListeners(this)}j.prototype={setSize:function(s,r){this.width=s;this.height=r;this.halfWidth=Math.round(s/2);this.halfHeight=Math.round(r/2);this.canvasEl.width=s;this.canvasEl.height=r;this.g2d.width=this.canvasEl.width;this.g2d.height=this.canvasEl.height},requestRender:function(){if(!this.renderIsInQueue){this.renderIsInQueue=true;var r=this;requestAnimationFrame(function(){r.render()})}},setClass:function(r){if(!r){console.log("error: no class given");return}this.canvasEl.className=r},registerListeners:function(r){r.canvasEl.addEventListener("mousedown",function(s){s.preventDefault();r.mouseIsDown=true;r.processMouseTouch("mousedown",s.pageX-this.offsetLeft,s.pageY-this.offsetTop)},false);r.canvasEl.addEventListener("mousemove",function(s){s.preventDefault();if(r.mouseIsDown){r.processMouseTouch("mousedown",s.pageX-this.offsetLeft,s.pageY-this.offsetTop)}},false);r.canvasEl.addEventListener("mouseout",function(s){s.preventDefault();r.mouseIsDown=false},false);r.canvasEl.addEventListener("mouseup",function(s){s.preventDefault();r.processMouseTouch("mouseup",s.pageX-this.offsetLeft,s.pageY-this.offsetTop);r.mouseIsDown=false},false);r.canvasEl.addEventListener("touchstart",function(t){t.preventDefault();for(var s=0;s<t.touches.length;s++){if(t.touches[s].target===this){r.processMouseTouch("touchstart",t.touches[s].pageX-this.offsetLeft,t.touches[s].pageY-this.offsetTop)}}},false);r.canvasEl.addEventListener("touchmove",function(t){t.preventDefault();for(var s=0;s<t.touches.length;s++){if(t.touches[s].target===this){r.processMouseTouch("touchmove",t.touches[s].pageX-this.offsetLeft,t.touches[s].pageY-this.offsetTop)}}},false);r.canvasEl.addEventListener("touchend",function(s){s.preventDefault();r.processMouseTouch("touchend")},false)},render:function(){},processMouseTouch:function(s,r,t){}};function e(s){if(!s){return}if(typeof(s.notify)=="function"){this.notify=s.notify}else{throw"constructor needs a notify function to be useful";return}if(!s.label){s.label=""}if(!s.fillstyle){s.fillstyle="#666666"}if(!s.width){if(this instanceof l){s.width=20}else{s.height=100}}if(!s.height){if(this instanceof l){s.height=100}else{s.height=20}}if(s.outputIsOverridden){this.outputIsOverridden=s.outputIsOverridden}else{this.outputIsOverridden=false}this.labelEl=document.createElement("div");this.outputEl=document.createElement("div");j.call(this,s);this.labelEl.appendChild(document.createTextNode(s.label));this.parentEl.insertBefore(this.labelEl,this.canvasEl);this.parentEl.appendChild(this.outputEl);this.val=0;this.lastVal=0;this.g2d=this.canvasEl.getContext("2d");this.setSize(s.width,s.height);this.g2d.clearRect(0,0,this.width,this.height);this.g2d.fillStyle=s.fillstyle;if(s.sliderCss){for(var r in s.sliderCss){this.canvasEl.style[r]=s.sliderCss[r]}}if(s.initVal){this.setValue(s.initVal)}else{this.setValue(0)}}e.prototype=new j;e.prototype.setClass=function(r){j.prototype.setClass.call(this,r);if(!r){console.log("slider set class error: no class given");return}this.labelEl.className=r;this.outputEl.className=r};e.prototype.setValue=function(r){if(r<0||r>1){console.log("slider set value input outOfBounds, try [0 - 1]");return}if(this instanceof l){this.setVal(r*this.height)}else{this.setVal(r*this.width)}};e.prototype.setVal=function(r){if(r<0){r=0}this.val=r;this.notify(this.getVal());this.requestRender()};e.prototype.render=function(){if(!this.outputIsOverridden){this.outputEl.textContent=this.getVal()}};function l(r){e.call(this,r)}l.prototype=new e;l.prototype.setVal=function(r){if(r>this.height){r=this.height}e.prototype.setVal.call(this,r)};l.prototype.getVal=function(){return Math.round((this.val/this.height)*100)/100};l.prototype.render=function(){e.prototype.render.call(this);this.g2d.clearRect(0,this.height-this.lastVal-11,this.width,22);this.g2d.fillRect(0,this.height-this.val-10,this.width,20);this.lastVal=this.val;this.renderIsInQueue=false};l.prototype.processMouseTouch=function(s,r,t){if(s=="touchend"){return}this.setVal(this.height-t)};function m(r){e.call(this,r)}m.prototype=new e;m.prototype.setVal=function(r){if(r>this.width){r=this.width}e.prototype.setVal.call(this,r)};m.prototype.getVal=function(){return Math.round((this.val/this.width)*100)/100};m.prototype.render=function(){e.prototype.render.call(this);this.g2d.clearRect(this.lastVal-11,0,22,this.height);this.g2d.fillRect(this.val-10,0,20,this.height);this.lastVal=this.val;this.renderIsInQueue=false};m.prototype.processMouseTouch=function(s,r,t){if(s=="touchend"){return}this.setVal(r)};function p(t){if(!t.numBins){throw"discrete vertical slider needs an integer number of bins";return}this.numBins=t.numBins;this.binSize=Math.floor(t.height/this.numBins);this.lineWidth=4;this.renderHeight=this.binSize-this.lineWidth;this.currentBin=0;this.lastBin=-99;this.binBorderColor=t.binBorderColor;e.call(this,t);var r=this.g2d.fillStyle;this.g2d.fillStyle=this.binBorderColor;for(var s=0;s<=this.numBins;s++){this.g2d.fillRect(0,Math.floor(s*this.binSize),this.height,this.lineWidth)}this.g2d.fillStyle=r}p.prototype=new e;p.prototype.setVal=function(s){if(s>this.height){s=this.height}var r=s/this.height;r*=this.numBins;r=Math.floor(r);if(r<0){r=0}else{if(r>=this.numBins){r=this.numBins-1}}this.currentBin=r;if(this.currentBin!=this.lastBin){e.prototype.setVal.call(this,s)}};p.prototype.setBin=function(s){if(s<0||s>=this.numBins){throw"indexOutOfBounds Exception";return}this.currentBin=s;if(this.currentBin!=this.lastBin){var r=this.currentBin*this.height;e.prototype.setVal.call(this,r)}};p.prototype.getVal=function(){return this.currentBin};p.prototype.render=function(){e.prototype.render.call(this);this.g2d.clearRect(0,Math.floor(this.lastBin*this.binSize)+this.lineWidth,this.width,this.renderHeight);this.g2d.fillRect(0,Math.floor(this.currentBin*this.binSize)+this.lineWidth,this.width,this.renderHeight);this.lastBin=this.currentBin;this.renderIsInQueue=false};p.prototype.processMouseTouch=function(s,r,t){if(s=="touchend"){return}this.setVal(t)};function a(t){if(!t.numBins){throw"discrete horizontal slider needs an integer number of bins";return}this.numBins=t.numBins;this.binSize=Math.floor(t.width/this.numBins);this.lineWidth=4;this.renderWidth=this.binSize-this.lineWidth;this.currentBin=0;this.lastBin=-99;this.binBorderColor=t.binBorderColor;e.call(this,t);var r=this.g2d.fillStyle;this.g2d.fillStyle=this.binBorderColor;for(var s=0;s<=this.numBins;s++){this.g2d.fillRect(Math.floor(s*this.binSize),0,this.lineWidth,this.height)}this.g2d.fillStyle=r}a.prototype=new e;a.prototype.setVal=function(s){if(s>this.width){s=this.width}var r=s/this.width;r*=this.numBins;r=Math.floor(r);if(r<0){r=0}else{if(r>=this.numBins){r=this.numBins-1}}this.currentBin=r;if(this.currentBin!=this.lastBin){e.prototype.setVal.call(this,s)}};a.prototype.setBin=function(s){if(s<0||s>=this.numBins){throw"indexOutOfBounds Exception";return}this.currentBin=s;if(this.currentBin!=this.lastBin){var r=this.currentBin*this.width;e.prototype.setVal.call(this,r)}};a.prototype.getVal=function(){return this.currentBin};a.prototype.render=function(){e.prototype.render.call(this);this.g2d.clearRect(Math.floor(this.lastBin*this.binSize)+this.lineWidth,0,this.renderWidth,this.height);this.g2d.fillRect(Math.floor(this.currentBin*this.binSize)+this.lineWidth,0,this.renderWidth,this.height);this.lastBin=this.currentBin;this.renderIsInQueue=false};a.prototype.processMouseTouch=function(s,r,t){if(s=="touchend"){return}this.setVal(r)};function c(r){if(!r){return}j.call(this,r);if(!r.cssClass){this.canvasEl.style.background="#ffffff";this.canvasEl.style.border="1px solid #333333"}this.g2d.clearRect(0,0,this.width,this.height);this.g2d.fillStyle=r.fillStyle;this.isMigrating=false;this.notify=r.notify;this.cvsPos={thisX:0,thisY:0,prevX:0,prevY:0};this.normalVal={x:0,y:0};if(r.radius==undefined){this.cvsPos.radius=20}else{this.cvsPos.radius=r.radius}this.cvsPos.radius2=this.cvsPos.radius*2;this.twoPi=2*Math.PI;this.setNormalPosition(0.5,0.5)}c.prototype=new j;c.prototype.processMouseTouch=function(s,r,t){if(s=="touchend"){return}if(r<0){r=0}else{if(r>=this.width){r=this.width-1}}if(t<0){t=0}else{if(t>=this.height){t=this.height-1}}this.cvsPos.thisX=r;this.cvsPos.thisY=t;this.setRealPosition(r,t);this.requestRender()};c.prototype.render=function(){this.g2d.clearRect(this.cvsPos.prevX-this.cvsPos.radius-1,this.cvsPos.prevY-this.cvsPos.radius-1,this.cvsPos.radius2+2,this.cvsPos.radius2+2);this.g2d.beginPath();this.g2d.arc(this.cvsPos.thisX,this.cvsPos.thisY,this.cvsPos.radius,0,this.twoPi);this.g2d.closePath();this.g2d.fill();this.cvsPos.prevX=this.cvsPos.thisX;this.cvsPos.prevY=this.cvsPos.thisY;if(this instanceof i){return}this.renderIsInQueue=false};c.prototype.setRealPosition=function(r,s){this.normalVal.x=r/this.width;this.normalVal.y=(this.height-s)/this.height;if(this instanceof i){return}this.notify({x:this.normalVal.x,y:this.normalVal.y})};c.prototype.setNormalPosition=function(r,s){this.processMouseTouch("",r*this.width,this.height-s*this.height)};c.prototype.getRealVal=function(){return{x:this.cvsPos.thisX,y:this.cvsPos.thisY}};c.prototype.getNormalVal=function(){return this.normalVal};function i(r){if(!r){return}c.call(this,r);if(!r.crosshairStyle){this.crosshairStyle="#333333"}else{this.crosshairStyle=r.crosshairStyle}}i.prototype=new c;i.prototype.setRealPosition=function(r,s){c.prototype.setRealPosition.call(this,r,s);this.notify({x:this.normalVal.x-0.5,y:this.normalVal.y-0.5})};i.prototype.processMouseTouch=function(s,r,t){if(s=="mouseout"||s=="mouseup"||s=="touchend"){this.isMigrating=true;this.migrate()}else{c.prototype.processMouseTouch.call(this,s,r,t)}};i.prototype.render=function(){c.prototype.render.call(this);var r=this.g2d.fillStyle;this.g2d.fillStyle=this.crosshairStyle;this.g2d.beginPath();this.g2d.moveTo(this.halfWidth,0);this.g2d.lineTo(this.halfWidth,this.height);this.g2d.moveTo(0,this.halfHeight);this.g2d.lineTo(this.width,this.halfHeight);this.g2d.stroke();this.g2d.fillStyle=r;this.renderIsInQueue=false};i.prototype.migrate=function(){var v=0.3;var t=0-(this.normalVal.x-0.5);var s=0-(this.normalVal.y-0.5);var z=Math.sqrt(t*t+s*s);if(z>0.05){var r=this.normalVal.x+(v*t);var w=this.normalVal.y+(v*s);this.setNormalPosition(r,w);var u=this;requestAnimationFrame(function(){u.migrate()})}else{this.setNormalPosition(0.5,0.5);this.isMigrating=false}};function g(r){if(!r){return}j.call(this,r);if(!r.cssClass){this.canvasEl.style.background="#ffffff";this.canvasEl.style.border="1px solid #333333"}if(!r.radius){this.radius=this.width/3}else{this.radius=r.radius}if(!r.outline){this.outline="#cccccc"}else{this.outline=r.outline}if(!r.fillStyle){this.fillStyle="#333333"}else{this.fillStyle=r.fillStyle}this.realVal;this.theta=0;this.notify=r.notify;this.minAngle=0.75*Math.PI;this.maxAngle=0.25*Math.PI;this.range=1.5*Math.PI;this.fillstyle=r.fillstyle;this.setSize(r.width,r.height);this.render()}g.prototype=new j;g.prototype.render=function(){this.g2d.strokeStyle=this.outline;this.g2d.lineWidth=this.radius;this.g2d.beginPath();this.g2d.arc(this.halfWidth,this.halfHeight,this.radius,this.minAngle,this.maxAngle);this.g2d.stroke();this.g2d.strokeStyle=this.fillStyle;this.g2d.lineWidth=this.radius-10;this.g2d.beginPath();this.g2d.arc(this.halfWidth,this.halfHeight,this.radius,this.minAngle,this.theta);this.g2d.stroke();this.renderIsInQueue=false};g.prototype.processMouseTouch=function(t,r,v){if(t=="touchend"){return}r=r-this.halfWidth;v=v-this.halfHeight;var u;var s=Math.atan(v/r);if(r<0){s+=Math.PI;u=s-this.minAngle}else{if(v<0){s+=2*Math.PI;u=s-this.minAngle}else{u=s-this.minAngle+2*Math.PI}}if(s>this.maxAngle&&s<this.minAngle){return}u/=this.range;this.realVal=u;this.notify(u);this.theta=s;this.requestRender()};g.prototype.getVal=function(){return this.realVal};g.prototype.setVal=function(s){if(s<0||s>1){throw"valueOutOfBounds Exception, takes [0 - 1]";return}this.realVal=s;var r=s*this.range;this.theta=r+this.minAngle;this.notify(s);this.requestRender()};function d(s){if(!s){return}j.call(this,s);if(s.numSliders==undefined){this.numSliders=10}else{this.numSliders=s.numSliders}this.realVals=[];for(var r=0;r<this.numSliders;r++){this.realVals.push(Math.random())}this.g2d.fillStyle="#666666";this.notify=s.notify;this.errMsg="slider field values need an array of length ";this.errMsg+=this.numSliders}d.prototype=new j;d.prototype.setVal=function(r,s){if(r<0||r>=this.numSliders){throw"SliderField.setVal - indexOutOfBounds Exception";return}if(s<0){s=0}else{if(s>1){s=1}}this.realVals[r]=s;this.notify(this.realVals);this.requestRender()};d.prototype.setVals=function(s){if(!(s instanceof Array)){throw this.errMsg;return}else{if(s.length!=this.numSliders){throw this.errMsg;return}}for(var r=0;r<this.numSliders;r++){var t=s[r];if(t<0){t=0}else{if(t>1){t=1}}this.realVals[r]=t}this.notify(this.realVals);this.requestRender()};d.prototype.getVal=function(r){if(r<0||r>=this.numSliders){throw"SliderField.setVal - indexOutOfBounds Exception";return}return this.realVals[r]};d.prototype.getVal=function(){return this.realVals};function o(r){d.call(this,r);this.sliderHeight=Math.floor(this.height/this.numSliders);this.render()}o.prototype=new d;o.prototype.processMouseTouch=function(u,r,z){if(u=="touchend"){return}var s;for(var t=0;t<this.numSliders;t++){var w=t*this.sliderHeight;var v=w+this.sliderHeight;if(z>=w&&z<=v){s=t;break}}if(s==undefined){return}this.setVal(s,r/this.width)};o.prototype.render=function(){this.g2d.clearRect(0,0,this.width,this.height);for(var r=0;r<this.numSliders;r++){this.g2d.fillRect(0,r*this.sliderHeight+2,this.realVals[r]*this.width,this.sliderHeight-2)}this.renderIsInQueue=false};function h(r){d.call(this,r);this.sliderWidth=Math.floor(this.width/this.numSliders);this.g2d.translate(0,this.height);this.g2d.scale(1,-1);this.render()}h.prototype=new d;h.prototype.processMouseTouch=function(u,r,z){if(u=="touchend"){return}var s;for(var t=0;t<this.numSliders;t++){var w=t*this.sliderWidth;var v=w+this.sliderWidth;if(r>=w&&r<=v){s=t;break}}if(s==undefined){return}this.setVal(s,(this.height-z)/this.height)};h.prototype.render=function(){this.g2d.clearRect(0,0,this.width,this.height);for(var r=0;r<this.numSliders;r++){this.g2d.fillRect(r*this.sliderWidth+2,0,this.sliderWidth-2,this.realVals[r]*this.height)}this.renderIsInQueue=false};var f=function(t){if(!t){return}this.val;this.notify;this.element;this.on;this.off;if(t.elementId){try{this.element=document.getElementById(t.elementId);if(this.element==null){throw"cannot build button: param object needs an elementId";return}}catch(s){console.log("err getting element")}}else{throw"cannot build button: param object needs an elementId";return}if(typeof(t.notify)=="function"){this.notify=t.notify}else{throw"button constructor needs an notify function to be useful";return}if(t.on){this.on=t.on}else{throw"pram object needs on attributes"}if(t.off){this.off=t.off}else{throw"pram object needs off attributes"}if(t.cssClassName){this.setClass(t.cssClassName)}if(t.css){for(var r in t.css){this.element.style[r]=t.css[r]}}this.createListeners(this)};f.prototype={createListeners:function(r){try{r.element.addEventListener("mousedown",function(t){t.preventDefault();r.processAction()},false)}catch(s){console.log("error creating mouse listener")}try{r.element.addEventListener("touchstart",function(t){t.preventDefault();r.processAction()},false)}catch(s){console.log("error creating touch listener")}},render:function(s){if(s){for(var r in this.on){if(r=="textContent"){this.element[r]=this.on[r]}else{this.element.style[r]=this.on[r]}}}else{for(var r in this.off){if(r=="textContent"){this.element[r]=this.off[r]}else{this.element.style[r]=this.off[r]}}}},setClass:function(r){if(r==null){console.log("error: no class given");return}this.element.className=r},processAction:function(){}};function b(r){f.call(this,r);if(r.val){this.setVal(r.val)}else{this.setVal(false)}}b.prototype=new f;b.prototype.processAction=function(){this.val=!this.val;this.notify(this.val);this.render(this.val)};b.prototype.setVal=function(r){this.val=r;this.notify(this.val);this.render(this.val)};b.prototype.getVal=function(){return this.val};function n(r){f.call(this,r);this.timeout;this.timeoutTime;if(!isNaN(r.triggerTimeout)){this.timeoutTime=r.triggerTimeout}else{throw"constructor error: need a numeric timeout parameter";return}this.render(false)}n.prototype=new f;n.prototype.processAction=function(){this.notify();this.render(true);clearTimeout(this.timeout);var r=this;this.timeout=setTimeout(function(){r.render(false)},r.timeoutTime)};q.VertSlider=l;q.HorizSlider=m;q.DiscreteVertSlider=p;q.DiscreteHorizSlider=a;q.ToggleButton=b;q.TriggerButton=n;q.Slider2D=c;q.Joystick=i;q.Knob=g;q.SliderFieldHoriz=o;q.SliderFieldVert=h;k.TouchLib=q})(window);